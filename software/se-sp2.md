# SP 2.2

Емулятор комп'ютера **Sinclair ZX Spectrum 48**.

Автор: Alexander Gusev (1993 р.)  
Системні вимоги: Enterprise 128k  
EXOS-сумістність:
 - версія 2.1 - не працює на комп'ютерах з розширенням пам'яті
 - версія 2.2 - працює на комп'ютерах з розширенням пам'яті

Підтримка форматів для завантаження:
 - аудіовхід (у форматі стандартного сигналу для ZX Spectrum) 
 - файл снепшоту у власному форматі який можна завантажувати з EXOS-сумісних накопичувачів.

Підтримка форматів для зберігання:
 - аудіовихід (у форматі стандартного сигналу для ZX Spectrum) 
 - файл снепшоту у власному форматі який можна зберегти на EXOS-сумісний накопичувач.

Емуляція пристроїв введення:

 - Kempston Joystick: [Internal Joystick](../sf-games/controllers.md) та [External Joystick 1](../sf-games/controllers.md) (але в деяких іграх емуляція Кемпстона все ж може не працювати)

Емуляція аудіопристроїв:

- Beeper: моно (тільки лівий канал)


|                                                    |                                                |
| -------------------------------------------------- | ---------------------------------------------- |
| ![екран емуляції SP2](screenshots/scrn_sp2_01.png) | ![екран допомоги](screenshots/scrn_sp2_02.png) |


## Робота з емулятором

### Гарячі клавіши (під час емуляції)

`F1`: збільшити таймаут доступу до пам'яті (система почне працювати із швидкодією оригінального ZX Spectrum)  
`F2`: повернути нормальний таймаут доступу до пам'яті  
`F5`: перейти у IS-Basic без переривання емуляції (для операцій із снепшотами). Введіть `:SP` щоб повернутись до емуляції ZX Spectrum.  
`Reset` (одинарний): очищення пам'яті Спектруму та вихід у IS-Basic (введіть `:SP` щоб відкрити початковий екран ZX Spectrum).

### команди EXOS

`:sp`: запустити емулятор (або повернутись до екрану емуляції)  
`:sp $назва_файлу`: зберегти поточний стан емулятора у снепшот.  
`:sp #назва_файлу` або `:sp #`: завантажити снепшот в емулятор.  

### Нотатки

Перед будь-якими операціями з оригінальною касетою ZX (завантаженням чи збереженням) необхідно натиснути **F1**, щоб збільшити таймінг доступу до пам'яті, таким чином, щоб система запрацювала приблизно з такою ж швидкодією, як і оригінальний ZX Spectrum. Після завершення операцій з ZX-касетою натисніть **F2**, щоб відновити звичайний таймінг доступу до пам'яті.

Для збереження снепшоту у потрібний момент необхідно натиснути **F5** щоб повернутись до середовища Ентерпрайзу. Командою `:sp $назва_файлу` можна зберегти снепшот. Для повернення до поточної емуляції Спектруму введіть команду `:sp`.

Завантажити снепшот можна відразу після завантаження емулятора командою `:sp #назва_файлу` або `:sp #`.

Завантажити з касетного накопичувача емулятор а потім відразу снепшот можна за допомогою наступної програми для Бейсіку:
```
100 LOAD "SP2.EXT"
110 EXT "SP #назва_снепшоту"
```
(головна складність у введенні першої стрічки: щоб її сформувати необхідно BAS-файл правити у HEX-редакторі)

[Універсальний BAS-файл для автозавантаження снепшотів](files/spload.bas).  
На стрічку записати спочатку цей файл, потім SP2.ext, а за ним файл снепшоту, після чого все завантажиться автоматично.

## Формат снепшоту

Розмір файлу: 49975 байтів

**0337h**-**1E37h**: екран у форматі SCR (6912 байтів)

Щоб модифікувати снепшот використовуючи POKE потрібно від POKE-адреси відняти **15561** (або **3СС9h**) і отримуємо розташування байта який потрібно змінити у HEX-редакторі.  
Наприклад: poke 62745-15561=47184 (або B850h)