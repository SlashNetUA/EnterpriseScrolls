# Генерація звуку

Тип каналів: аудіоканал

Для фактичного створення звуку необхідно надіслати керуючу послідовність, яка визначає звук.

Формат:

`esc S <env> <p> <vl> <vr> <sty> <ch> <d> <f>`

hex: `1B`,`53`,**env**,**p**,**vl**,**vr**,**sty**,**ch**,**d**,**f**

dec: `27`,`83`,**env**,**p**,**vl**,**vr**,**sty**,**ch**,**d**,**f**

Значення кожного поля:

**env**: (8 біт) Обвідна, яка використовується для цього звуку. Номер обвідної **255** видасть звук типу "бип", який має постійну амплітуду та висоту протягом усього звуку.

**p**: (16 біт) Початкова висота звуку в 1/512 півтонах. Тільки точні чвертьтони обов'язково будуть музично правильними. Інші генеруються лінійною інтерполяцією. Ігнорується для шумового каналу.

**vl**: (8 біт) Загальна ліва амплітуда (гучність). (**0**—**255**)
**vr**: (8 біт) Загальна права амплітуда (гучність). (**0**—**255**)

**sty**: (8 біт) Байт стилю звуку. Для шумового каналу цей байт поміщається в регістр керування шумом на час тривалості звуку. Для тонального каналу чотири верхні біти поміщаються в чотири біти керування звуком у регістрі частоти звуку для цього каналу, таким чином вони контролюють фільтрацію, спотворення та модуляцію кільця. Нуль дає чистий тон або білий шум. Див. окрему специфікацію мікросхеми DAVE для значення кожного біта в цих регістрах.

**ch**: (8 біт) Джерело для цього звуку. **0**, **1** або **2** для відповідного *тонального каналу* та **3** для *шумового каналу*.

**d**: (16 біт) Тривалість цього звуку в тактах.

**f**: (8 біт) Байт прапорців.
	**b0**—**b1**: Лічильник синхронізації для цього звуку. Див. розділ про синхронізацію.
	**b2**—**b6**: Не використовується, має бути нульовим.
	**b7**: Встановлюється для примусового перевизначення будь-якого звуку в черзі для цього каналу. Очищається, щоб звук чекав своєї черги.

Коли звук отримано, він додається до кінця відповідної черги (спочатку завершується черга, якщо встановлено біт 7 байта прапорців). Якщо черга заповнена, то існують два варіанти дій, які залежать від стану змінної EXOS [WAIT_SND](../exos-variables/exos_var13.md). Якщо це значення дорівнює нулю, то звуковий драйвер просто чекатиме, поки в черзі звуку звільниться місце, перевіряючи клавішу `Stop`, щоб дозволити її переривання. Якщо ця змінна EXOS не дорівнює нулю, то користувачеві буде повернуто код помилки (`.SQFUL`).

[IS-Basic](../../is-basic_man-en/man_2-sound.md).  
[HiSoft Pascal](../../hisoft-pascal-hpu/sound.hpu.md).

## Eng 

Sound Production

To actually produce a sound an escape sequence must be sent which defines the sound. The format of this is:

`esc S <env> <p> <vl> <vr> <sty> <ch> <d> <f>`

The meaning of each field is: 

**env**: (8 bit) Envelope to use for this sound. An envelope number of 255 will produce a "beep" type sound which is of constant amplitude and pitch for the duration of the sound.

**p**: (16 bit) Starting pitch of sound in 1/512 semitones. Only exact quartertones will necessarily be musically correct. The others are generated by linear interpolation. Ignored for noise channel.

**vl**: (8 bit) Overall left amplitude. (**0**—**255**)  
**vr**: (8 bit) Overall right amplitude. (**0**—**255**)  

**sty**: (8 bit) Sound style byte. For the noise channel, this byte is put into the noise control register for the duration of the sound. For a tone channel the top four bits are put into the four sound control bits in the sound frequency register for that channel, they thus control filtering, distortion and ring modulation. Zero gives a pure tone or white noise. See separate DAVE chip specification for meaning of each bit in these registers.
 
**ch**: (8 bit) Source for this sound. **0**, **1** or **2** for the appropriate *tone channel* and **3** for the *noise channel*.
  
**d**: (16 bit) Duration of this sound in ticks.
   
**f**: (8 bit) Flags byte.
	**b0**—**b1**: SYNC count for this sound. See later section on synchronisation.
	**b2**—**b6**: Not used, should be zero.
	**b7**: Set to force over-ride of any sound in queue for this channel. Clear to make sound wait its turn. 

When a sound is received it is added to the end of the approprriate queue (killing the queue first if bit-7 of the flags byte is set). If the queue is full then there are two courses of action which depend on the state of the EXOS variable [WAIT_SND](../exos-variables/exos_var13.md). If this is zero then the sound driver will just wait until there is space in the sound queue, testing the stop key to allow it to be interrupted. If this EXOS variable is non-zero then it will return an error code (`.SQFUL`) to the user.