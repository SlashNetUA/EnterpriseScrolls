# SOUND.HPU
# Опис

Використовуючи колекцію підпрограм **SOUND.HPU** для версії 1.2, ми можемо використовувати опції генерації звуку, доступні в EXOS. Це рішення дозволяє програмувати голос за стандартом, подібним до того як це робиться у [IS-Basic](../is-basic_man-en/man_2-sound.md).

Розширення включає такі процедури:

# SoundInit
Відкрити канал **103** для звукового пристрою. HiSoft Pascal не робить цього автоматично (як BASIC), тому це має бути першим, що ви повинні зробити перед спробою будь-якої генерації звуку.

# Ping
Вивести звук, схожий на дзвіночок, ідентичний команді BASIC [PING](../is-basic_man-en/man_cs-ping.md).

# Sound (env, pitch, durat, left, right, style, source, flag)
Вивести звук відповідно до заданих параметрів. Усі параметри є **INTEGER**:

- **env** – Обвідна, яка буде використовуватись (**ENVELOPE**). Якщо раніше не було визначено жодної обвідної (див. процедури **ENVELOPE**, **ENVPHASE**), можна використовувати лише обвідну номер **255**, яка створює звук, схожий на цвірінькання, амплітуда та частота якого постійні протягом усієї тривалості звуку.

- **pitch** – Призначити висоту звуку в півтонах. Висота тону може бути від **0** до **127**, де **37** відповідає *середньому ДО*.

- **durat** – визначає тривалість звуку в **1/50** секунди. Вказане значення може бути від **0** до **32 767**.

- **left** – Визначає гучність лівого динаміка відносно максимально можливого рівня (**0** = без звуку, **255** = повна гучність).

- **right** – Визначає гучність правого динаміка відносно максимально можливого рівня (**0** = без звуку, **255** = повна гучність).

- **style** – Байт типу звуку ([STYLE](../is-basic_man-en/man_so-sound-style.md)) (тобто його значення може бути від **0** до **255**). У випадку шумового каналу цей байт записується в регістр керування шумом на весь час відтворення звуку. Для голосового каналу чотири старші біти записуються в чотири біти керування голосом регістра голосової частоти відповідного каналу. Вони контролюють фільтрацію, спотворення та кільцеву модуляцію. Нульове значення створює чистий звук або білий шум.

- **source** – джерело звуку ([SOURCE](../is-basic_man-en/man_cs-sound.md)). Його значення становить **0**, **1** або **2** для відповідних аудіоканалів та **3** для шумового каналу.

- **flag** – байт прапорця (тобто його значення має бути в діапазоні від **0** до **255**).
    - **b0**...**b1**: [SYNC](../is-basic_man-en/man_cs-sound.md).
    - **b2**...**b6**: (не використовується, має бути нульовим).
    - **b7**: Коли встановлено, примусово скасовується будь-який звук, що стоїть у черзі на цьому каналі ([INTERRUPT](../is-basic_man-en/man_cs-sound.md)). Він чекає своєї черги, щоб його стерли.

# Envelope (env, ep, er)
Вказує на початок визначення звукової обвідної. Усі параметри є **INTEGER**:

- **env** – Порядковий номер аудіообвідної, має бути в діапазоні від **0** до **254**.
- **ep** – Кількість усіх фаз в обвідній (**1**-**40**).
- **er** - Кількість фаз до відпускання ([RELEASE](../is-basic_man-en/man_cs-sound.md)). Якщо фаза затухання не потрібна, це значення дорівнює **255**, що призводить до негайного завершення звуку після закінчення його тривалості.

# EnvPhase(cpitch, cleft, cright, durat)
Визначає фазу обвідної. Процедуру **ENVELOPE** має супроводжувати стільки процедур **ENVPHASE**, скільки фаз міститься в обвідній (значення вказано в **ep**). Якщо значення **er** не дорівнює **255**, останнє число **er**, яке визначає процедура **ENVPHASE**, визначає фазу розпаду (**RELEASE**). Усі параметри є **INTEGER**:
 
- **cpitch** - зміна частоти.
- **cleft** - зміна гучності зліва.
- **cright** - зміна гучності праворуч.
- **durat** - тривалість фази в **1/50** секунди.

# ClearQueue
Зупиняє всі джерела звуку та очищує всі запити **SOUND**, що очікують на розгляд (тобто очищує всі звуки, що очікують на розгляд, у черзі).

# CloseSound
Закриває раніше відкритий канал **103**. «Належно написана» програма не пропустить цей крок до завершення виконання.

# Нотатки
Скомпільована програма на PASCAL "завантажує" звук на пристрій **SOUND:** набагато швидше, ніж BASIC, тому це може спричинити проблеми, якщо буфер, зарезервований для звуків у черзі, переповниться. У цьому випадку, за замовчуванням, процедура **SOUND** чекає, поки в черзі не звільниться місце для звуку, який потрібно вставити. Це може призвести до різкого уповільнення програми PASCAL.  

Для вирішення цієї ситуації використовується змінна [13 EXOS](../exos-info/exos-variables/exos_var13.md): якщо її значення знаходиться в інтервалі між **1**..**255**, очікування не відбувається, натомість пристрій **SOUND:** повертає помилку `.SQFUL` у **RA**. Щоб обробити цю помилку, нам потрібно повторно поставити в чергу звук, який не вдалося відтворити в попередній спробі.